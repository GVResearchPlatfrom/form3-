<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Access Request Form</title>
<style>
  :root{--bg:#f7f9fc;--card:#fff;--accent:#0b74de;--muted:#556;}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:0;background:var(--bg);color:#111;}
  .wrap{max-width:720px;margin:36px auto;padding:20px;}
  .card{background:var(--card);border-radius:10px;padding:24px;box-shadow:0 6px 20px rgba(2,6,23,0.08);}
  h1{margin:0 0 8px;font-size:1.2rem}
  p.lead{margin:0 0 16px;color:var(--muted)}
  form{display:grid;gap:12px}
  label{font-size:0.9rem}
  input[type="text"],input[type="email"],input[type="tel"]{
    width:100%;padding:10px;border-radius:8px;border:1px solid #e2e6ef;background:#fff;font-size:0.95rem;
  }
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .full{grid-column:1/-1}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
  button{padding:10px 14px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
  .btn-primary{background:var(--accent);color:#fff}
  .small{font-size:0.85rem;color:var(--muted)}
  @media (max-width:620px){ .row{grid-template-columns:1fr} .actions{flex-direction:column-reverse} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="region" aria-labelledby="formTitle">
    <h1 id="formTitle">Quick Access Form</h1>
    <p class="lead">Please enter your details to access the document.</p>

    <!-- Formspree form (new endpoint) -->
    <form id="shortForm"
          action="https://formspree.io/forms/manlzoqo/integration"
          method="POST"
          target="_self"
          novalidate>
      <div class="row">
        <div class="full">
          <label for="name">Full Name *</label>
          <input id="name" name="name" type="text" required placeholder="Jane Doe" />
        </div>

        <div>
          <label for="org">Organisation / Company *</label>
          <input id="org" name="org" type="text" required placeholder="Acme Labs" />
        </div>

        <div>
          <label for="email">Email Address *</label>
          <input id="email" name="email" type="email" required placeholder="name@company.com" />
        </div>

        <div>
          <label for="mobile">Mobile Number <span class="small">(optional)</span></label>
          <input id="mobile" name="mobile" type="tel" placeholder="+91 91234 56789" />
        </div>

        <div class="full small" style="margin-top:6px">
          <label>
            <input id="consent" name="consent" type="checkbox" value="Yes" required />
            I consent to my data being used for granting access and follow-up communication.
          </label>
        </div>
      </div>

      <!-- fallback server redirect (Formspree) -->
      <input type="hidden" name="_next" value="https://qrco.de/bgQiBl" />
      <input type="hidden" name="_subject" value="New QR Access submission" />

      <div id="error" class="small" style="color:#b00020;display:none"></div>

      <div class="actions">
        <button type="reset" class="btn-ghost" id="resetBtn">Reset</button>
        <button type="submit" class="btn-primary" id="submitBtn">Access Document</button>
      </div>
    </form>
    <!-- end form -->

    <p class="small" style="margin-top:12px">Your details will only be used to confirm access.</p>
  </div>
</div>

<script>
/* Submit via fetch to Formspree, then redirect client-side to the PDF.
   Required: Name, Organisation, Email, Consent. Mobile optional. */
(function(){
  const form = document.getElementById('shortForm');
  const err = document.getElementById('error');
  const submitBtn = document.getElementById('submitBtn');
  const PDF = "https://qrco.de/bgQiBl";

  function showError(text){
    err.textContent = text;
    err.style.display = 'block';
  }

  form.addEventListener('submit', async function(e){
    e.preventDefault();
    err.style.display = 'none';

    const name = (form.name.value || '').trim();
    const org  = (form.org.value || '').trim();
    const email= (form.email.value || '').trim();
    const consent = form.consent && form.consent.checked;

    if (!name || name.length < 2) { showError('Please enter your full name.'); return; }
    if (!org  || org.length < 2)  { showError('Please enter your organisation.'); return; }
    if (!email || !(form.email.checkValidity && form.email.checkValidity())) { showError('Please enter a valid email.'); return; }
    if (!consent) { showError('Please give consent to proceed.'); return; }

    submitBtn.disabled = true;
    submitBtn.textContent = 'Processing...';

    try {
      const formData = new FormData(form);
      const res = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: { 'Accept': 'application/json' }
      });

      if (res.ok) {
        // client-side redirect so user always gets the document
        window.location.href = PDF;
        return;
      } else {
        const text = await res.text().catch(()=>null);
        showError('Submission failed. Server replied: ' + (text || res.status));
      }
    } catch (fetchErr) {
      console.error('Fetch error:', fetchErr);
      // fallback: open doc in new tab and inform the user
      window.open(PDF, '_blank');
      showError('Submission failed due to network. Document opened in a new tab.');
    }

    submitBtn.disabled = false;
    submitBtn.textContent = 'Access Document';
  });
})();
</script>
</body>
</html>
