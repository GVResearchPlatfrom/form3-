<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Access Request Form</title>
<style>
  :root{--bg:#f7f9fc;--card:#fff;--accent:#0b74de;--muted:#556;}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:0;background:var(--bg);color:#111;}
  .wrap{max-width:720px;margin:36px auto;padding:20px;}
  .card{background:var(--card);border-radius:10px;padding:24px;box-shadow:0 6px 20px rgba(2,6,23,0.08);}
  h1{margin:0 0 8px;font-size:1.2rem}
  p.lead{margin:0 0 16px;color:var(--muted)}
  form{display:grid;gap:12px}
  label{font-size:0.9rem}
  input[type="text"],input[type="email"],input[type="tel"]{
    width:100%;padding:10px;border-radius:8px;border:1px solid #e2e6ef;background:#fff;font-size:0.95rem;
  }
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .full{grid-column:1/-1}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
  button{padding:10px 14px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
  .btn-primary{background:var(--accent);color:#fff}
  .small{font-size:0.85rem;color:var(--muted)}
  @media (max-width:620px){ .row{grid-template-columns:1fr} .actions{flex-direction:column-reverse} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="region" aria-labelledby="formTitle">
    <h1 id="formTitle">Quick Access Form</h1>
    <p class="lead">Please enter your details to access the document.</p>

    <form id="shortForm" novalidate>
      <div class="row">
        <div class="full">
          <label for="name">Full Name <span aria-hidden="true">*</span></label>
          <input id="name" name="name" type="text" required placeholder="Jane Doe" />
        </div>

        <div>
          <label for="org">Organisation / Company</label>
          <input id="org" name="org" type="text" placeholder="Acme Labs" />
        </div>

        <div>
          <label for="email">Email Address <span aria-hidden="true">*</span></label>
          <input id="email" name="email" type="email" required placeholder="name@company.com" />
        </div>

        <div>
          <label for="mobile">Mobile Number <span aria-hidden="true">*</span></label>
          <input id="mobile" name="mobile" type="tel" required placeholder="+91 91234 56789" />
        </div>

        <div class="full small" style="margin-top:6px">
          <label>
            <input id="consent" name="consent" type="checkbox" required />
            I consent to my data being used for granting access and follow-up communication. <a href="/privacy" target="_blank">Privacy Policy</a>.
          </label>
        </div>
      </div>

      <div id="error" class="small" style="color:#b00020;display:none"></div>

      <div class="actions">
        <button type="reset" class="btn-ghost" id="resetBtn">Reset</button>
        <button type="submit" class="btn-primary" id="submitBtn">Access Document</button>
      </div>
    </form>

    <p class="small" style="margin-top:12px">Your details will only be used to confirm access.</p>
  </div>
</div>

<script>
const REDIRECT_ON_SUCCESS = "https://qrco.de/bgQhI7";
let API_ENDPOINT = ""; // paste your Google Apps Script Web App URL here

const form = document.getElementById('shortForm');
const err = document.getElementById('error');
const submitBtn = document.getElementById('submitBtn');

function validate(data){
  if (!data.name || data.name.trim().length < 2) return 'Please enter your full name.';
  if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) return 'Please enter a valid email.';
  if (!data.mobile || !/\d{7,}/.test(data.mobile.replace(/\D/g,''))) return 'Please enter a valid mobile number.';
  if (!data.consent) return 'Please give consent to proceed.';
  return '';
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  err.style.display = 'none';
  submitBtn.disabled = true;
  submitBtn.textContent = 'Processing...';

  const data = {
    name: form.name.value.trim(),
    org: form.org.value.trim(),
    email: form.email.value.trim(),
    mobile: form.mobile.value.trim(),
    consent: form.consent.checked
  };

  const v = validate(data);
  if (v){
    err.textContent = v;
    err.style.display='block';
    submitBtn.disabled=false;
    submitBtn.textContent='Access Document';
    return;
  }

  try {
    if (API_ENDPOINT) {
      const res = await fetch(API_ENDPOINT, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
      });
      if (!res.ok) throw new Error('Server returned ' + res.status);
    }
    window.location.href = REDIRECT_ON_SUCCESS;

  } catch (ex) {
    err.textContent = 'Error: ' + ex.message;
    err.style.display = 'block';
    submitBtn.disabled = false;
    submitBtn.textContent = 'Access Document';
  }
});
</script>
</body>
</html>
